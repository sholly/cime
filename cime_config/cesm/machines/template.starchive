#! /usr/bin/env perl
#------------------------------------------------------------------------------
# Batch system directives
#------------------------------------------------------------------------------
{{ batchdirectives }}

my $scriptname = $0;
my $caseroot = "{{ caseroot }}";
my $cimeroot = "{{ cimeroot }}";
chdir $caseroot;
my $perl5lib = "$cimeroot/utils/perl5lib";
push(@INC, $perl5lib);
require Config::SetupTools;
require Batch::BatchUtils;
use Cwd;

#------------------------------------------------------------------------------
# PE Layout Documentation:
#------------------------------------------------------------------------------
{{ pedocumentation }}

# -------------------------------------------------------------------------
# global data needed by the script, stuff like the max number of threads,
# -------------------------------------------------------------------------

# First, get the configuration from every xml file.
my %config = SetupTools::getAllResolved();

qx(./st_archive >> stArchiveStatus 2>&1);
resubmitCheck();

sub resubmitCheck()
{
    my $submitscript = "$config{'CASEROOT'}/$config{'CASE'}.submit";
    my $cwd = getcwd;
    chdir $config{CASEROOT};
    my $resubmitcommand = "$submitscript -resubmit -scriptname $config{'CASE'}.st_archive";
    print "running resubmit check $resubmitcommand\n";
    qx($resubmitcommand) or warn "could not run CESM submit script, $! $?";
    chdir $cwd;
}
	
